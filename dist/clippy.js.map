{"version":3,"file":"clippy.js","sources":["../lib/queue.js","../lib/animator.js","../lib/balloon.js","../lib/agent.js","../lib/load.js","../lib/index.js"],"sourcesContent":["import $ from 'jquery'\r\n\r\nexport default class Queue {\r\n    constructor (onEmptyCallback) {\r\n        this._queue = [];\r\n        this._onEmptyCallback = onEmptyCallback;\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {function(Function)} func\r\n     * @returns {jQuery.Deferred}\r\n     */\r\n    queue (func) {\r\n        this._queue.push(func);\r\n\r\n        if (this._queue.length === 1 && !this._active) {\r\n            this._progressQueue();\r\n        }\r\n    }\r\n\r\n    _progressQueue () {\r\n\r\n        // stop if nothing left in queue\r\n        if (!this._queue.length) {\r\n            this._onEmptyCallback();\r\n            return;\r\n        }\r\n\r\n        let f = this._queue.shift();\r\n        this._active = true;\r\n\r\n        // execute function\r\n        let completeFunction = $.proxy(this.next, this);\r\n        f(completeFunction);\r\n    }\r\n\r\n    clear () {\r\n        this._queue = [];\r\n    }\r\n\r\n    next () {\r\n        this._active = false;\r\n        this._progressQueue();\r\n    }\r\n}\r\n\r\n\r\n\r\n","import $ from 'jquery'\r\n\r\nexport default class Animator {\r\n\r\n    constructor (el, path, data, sounds) {\r\n        this._el = el;\r\n        this._data = data;\r\n        this._path = path;\r\n        this._currentFrameIndex = 0;\r\n        this._currentFrame = undefined;\r\n        this._exiting = false;\r\n        this._currentAnimation = undefined;\r\n        this._endCallback = undefined;\r\n        this._started = false;\r\n        this._sounds = {};\r\n        this.currentAnimationName = undefined;\r\n        this.preloadSounds(sounds);\r\n        this._overlays = [this._el];\r\n        let curr = this._el;\r\n\r\n        this._setupElement(this._el);\r\n        for (let i = 1; i < this._data.overlayCount; i++) {\r\n            let inner = this._setupElement($('<div></div>'));\r\n            curr.append(inner);\r\n            this._overlays.push(inner);\r\n            curr = inner;\r\n        }\r\n    }\r\n\r\n    _setupElement (el) {\r\n        let frameSize = this._data.framesize;\r\n        el.css('display', \"none\");\r\n        el.css({ width: frameSize[0], height: frameSize[1] });\r\n        el.css('background', \"url('\" + this._path + \"/map.png') no-repeat\");\r\n\r\n        return el;\r\n    }\r\n\r\n    animations () {\r\n        let r = [];\r\n        let d = this._data.animations;\r\n        for (let n in d) {\r\n            r.push(n);\r\n        }\r\n        return r;\r\n    }\r\n\r\n    preloadSounds (sounds) {\r\n\r\n        for (let i = 0; i < this._data.sounds.length; i++) {\r\n            let snd = this._data.sounds[i];\r\n            let uri = sounds[snd];\r\n            if (!uri) continue;\r\n            this._sounds[snd] = new Audio(uri);\r\n\r\n        }\r\n    }\r\n\r\n    hasAnimation (name) {\r\n        return !!this._data.animations[name];\r\n    }\r\n\r\n    exitAnimation () {\r\n        this._exiting = true;\r\n    }\r\n\r\n    showAnimation (animationName, stateChangeCallback) {\r\n        this._exiting = false;\r\n\r\n        if (!this.hasAnimation(animationName)) {\r\n            return false;\r\n        }\r\n\r\n        this._currentAnimation = this._data.animations[animationName];\r\n        this.currentAnimationName = animationName;\r\n\r\n\r\n        if (!this._started) {\r\n            this._step();\r\n            this._started = true;\r\n        }\r\n\r\n        this._currentFrameIndex = 0;\r\n        this._currentFrame = undefined;\r\n        this._endCallback = stateChangeCallback;\r\n\r\n        return true;\r\n    }\r\n\r\n    _draw () {\r\n        let images = [];\r\n        if (this._currentFrame) images = this._currentFrame.images || [];\r\n\r\n        for (let i = 0; i < this._overlays.length; i++) {\r\n            if (i < images.length) {\r\n                let xy = images[i];\r\n                let bg = -xy[0] + 'px ' + -xy[1] + 'px';\r\n                this._overlays[i].css({ 'background-position': bg, 'display': 'block' });\r\n            }\r\n            else {\r\n                this._overlays[i].css('display', 'none');\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    _getNextAnimationFrame () {\r\n        if (!this._currentAnimation) return undefined;\r\n        // No current frame. start animation.\r\n        if (!this._currentFrame) return 0;\r\n        let currentFrame = this._currentFrame;\r\n        let branching = this._currentFrame.branching;\r\n\r\n\r\n        if (this._exiting && currentFrame.exitBranch !== undefined) {\r\n            return currentFrame.exitBranch;\r\n        }\r\n        else if (branching) {\r\n            let rnd = Math.random() * 100;\r\n            for (let i = 0; i < branching.branches.length; i++) {\r\n                let branch = branching.branches[i];\r\n                if (rnd <= branch.weight) {\r\n                    return branch.frameIndex;\r\n                }\r\n\r\n                rnd -= branch.weight;\r\n            }\r\n        }\r\n\r\n        return this._currentFrameIndex + 1;\r\n    }\r\n\r\n\r\n    _playSound () {\r\n        let s = this._currentFrame.sound;\r\n        if (!s) return;\r\n        let audio = this._sounds[s];\r\n        if (audio) audio.play();\r\n    }\r\n\r\n    _atLastFrame () {\r\n        return this._currentFrameIndex >= this._currentAnimation.frames.length - 1;\r\n    }\r\n\r\n\r\n    _step () {\r\n        if (!this._currentAnimation) return;\r\n        let newFrameIndex = Math.min(this._getNextAnimationFrame(), this._currentAnimation.frames.length - 1);\r\n        let frameChanged = !this._currentFrame || this._currentFrameIndex !== newFrameIndex;\r\n        this._currentFrameIndex = newFrameIndex;\r\n\r\n        // always switch frame data, unless we're at the last frame of an animation with a useExitBranching flag.\r\n        if (!(this._atLastFrame() && this._currentAnimation.useExitBranching)) {\r\n            this._currentFrame = this._currentAnimation.frames[this._currentFrameIndex];\r\n        }\r\n\r\n        this._draw();\r\n        this._playSound();\r\n\r\n        this._loop = window.setTimeout($.proxy(this._step, this), this._currentFrame.duration);\r\n\r\n\r\n        // fire events if the frames changed and we reached an end\r\n        if (this._endCallback && frameChanged && this._atLastFrame()) {\r\n            if (this._currentAnimation.useExitBranching && !this._exiting) {\r\n                this._endCallback(this.currentAnimationName, Animator.States.WAITING);\r\n            }\r\n            else {\r\n                this._endCallback(this.currentAnimationName, Animator.States.EXITED);\r\n            }\r\n        }\r\n    }\r\n\r\n    /***\r\n     * Pause animation execution\r\n     */\r\n    pause () {\r\n        window.clearTimeout(this._loop);\r\n    }\r\n\r\n    /***\r\n     * Resume animation\r\n     */\r\n    resume () {\r\n        this._step();\r\n    }\r\n}\r\n\r\n\r\nAnimator.States = { WAITING: 1, EXITED: 0 };\r\n","import $ from 'jquery'\r\n\r\nexport default class Balloon {\r\n    constructor (targetEl) {\r\n        this._targetEl = targetEl;\r\n\r\n        this._hidden = true;\r\n        this._setup();\r\n        this.WORD_SPEAK_TIME = 200;\r\n        this.CLOSE_BALLOON_DELAY = 2000;\r\n        this._BALLOON_MARGIN = 15;\r\n    }\r\n\r\n    _setup () {\r\n\r\n        this._balloon = $('<div class=\"clippy-balloon\"><div class=\"clippy-tip\"></div><div class=\"clippy-content\"></div></div> ').hide();\r\n        this._content = this._balloon.find('.clippy-content');\r\n\r\n        $(document.body).append(this._balloon);\r\n    }\r\n\r\n    reposition () {\r\n        let sides = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\r\n\r\n        for (let i = 0; i < sides.length; i++) {\r\n            let s = sides[i];\r\n            this._position(s);\r\n            if (!this._isOut()) break;\r\n        }\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param side\r\n     * @private\r\n     */\r\n    _position (side) {\r\n        let o = this._targetEl.offset();\r\n        let h = this._targetEl.height();\r\n        let w = this._targetEl.width();\r\n        o.top -= $(window).scrollTop();\r\n        o.left -= $(window).scrollLeft();\r\n\r\n        let bH = this._balloon.outerHeight();\r\n        let bW = this._balloon.outerWidth();\r\n\r\n        this._balloon.removeClass('clippy-top-left');\r\n        this._balloon.removeClass('clippy-top-right');\r\n        this._balloon.removeClass('clippy-bottom-right');\r\n        this._balloon.removeClass('clippy-bottom-left');\r\n\r\n        let left, top;\r\n        switch (side) {\r\n            case 'top-left':\r\n                // right side of the balloon next to the right side of the agent\r\n                left = o.left + w - bW;\r\n                top = o.top - bH - this._BALLOON_MARGIN;\r\n                break;\r\n            case 'top-right':\r\n                // left side of the balloon next to the left side of the agent\r\n                left = o.left;\r\n                top = o.top - bH - this._BALLOON_MARGIN;\r\n                break;\r\n            case 'bottom-right':\r\n                // right side of the balloon next to the right side of the agent\r\n                left = o.left;\r\n                top = o.top + h + this._BALLOON_MARGIN;\r\n                break;\r\n            case 'bottom-left':\r\n                // left side of the balloon next to the left side of the agent\r\n                left = o.left + w - bW;\r\n                top = o.top + h + this._BALLOON_MARGIN;\r\n                break;\r\n        }\r\n\r\n        this._balloon.css({ top: top, left: left });\r\n        this._balloon.addClass('clippy-' + side);\r\n    }\r\n\r\n    _isOut () {\r\n        let o = this._balloon.offset();\r\n        let bH = this._balloon.outerHeight();\r\n        let bW = this._balloon.outerWidth();\r\n\r\n        let wW = $(window).width();\r\n        let wH = $(window).height();\r\n        let sT = $(document).scrollTop();\r\n        let sL = $(document).scrollLeft();\r\n\r\n        let top = o.top - sT;\r\n        let left = o.left - sL;\r\n        let m = 5;\r\n        if (top - m < 0 || left - m < 0) return true;\r\n        return (top + bH + m) > wH || (left + bW + m) > wW;\r\n    }\r\n\r\n    speak (complete, text, hold) {\r\n        this._hidden = false;\r\n        this.show();\r\n        let c = this._content;\r\n        // set height to auto\r\n        c.height('auto');\r\n        c.width('auto');\r\n        // add the text\r\n        c.text(text);\r\n        // set height\r\n        c.height(c.height());\r\n        c.width(c.width());\r\n        c.text('');\r\n        this.reposition();\r\n\r\n        this._complete = complete;\r\n        this._sayWords(text, hold, complete);\r\n    }\r\n\r\n    show () {\r\n        if (this._hidden) return;\r\n        this._balloon.show();\r\n    }\r\n\r\n    hide (fast) {\r\n        if (fast) {\r\n            this._balloon.hide();\r\n            return;\r\n        }\r\n\r\n        this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\r\n    }\r\n\r\n    _finishHideBalloon () {\r\n        if (this._active) return;\r\n        this._balloon.hide();\r\n        this._hidden = true;\r\n        this._hiding = null;\r\n    }\r\n\r\n    _sayWords (text, hold, complete) {\r\n        this._active = true;\r\n        this._hold = hold;\r\n        let words = text.split(/[^\\S-]/);\r\n        let time = this.WORD_SPEAK_TIME;\r\n        let el = this._content;\r\n        let idx = 1;\r\n\r\n\r\n        this._addWord = $.proxy(function () {\r\n            if (!this._active) return;\r\n            if (idx > words.length) {\r\n                delete this._addWord;\r\n                this._active = false;\r\n                if (!this._hold) {\r\n                    complete();\r\n                    this.hide();\r\n                }\r\n            } else {\r\n                el.text(words.slice(0, idx).join(' '));\r\n                idx++;\r\n                this._loop = window.setTimeout($.proxy(this._addWord, this), time);\r\n            }\r\n        }, this);\r\n\r\n        this._addWord();\r\n\r\n    }\r\n\r\n    close () {\r\n        if (this._active) {\r\n            this._hold = false;\r\n        } else if (this._hold) {\r\n            this._complete();\r\n        }\r\n    }\r\n\r\n    pause () {\r\n        window.clearTimeout(this._loop);\r\n        if (this._hiding) {\r\n            window.clearTimeout(this._hiding);\r\n            this._hiding = null;\r\n        }\r\n    }\r\n\r\n    resume () {\r\n        if (this._addWord) {\r\n            this._addWord();\r\n        } else if (!this._hold && !this._hidden) {\r\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import $ from 'jquery'\r\nimport Queue from './queue'\r\nimport Animator from './animator'\r\nimport Balloon from './balloon'\r\n\r\nexport default class Agent {\r\n\r\n    constructor (path,data,sounds) {\r\n        this.path = path;\r\n\r\n        this._queue = new Queue($.proxy(this._onQueueEmpty, this));\r\n\r\n        this._el = $('<div class=\"clippy\"></div>').hide();\r\n\r\n        $(document.body).append(this._el);\r\n\r\n        this._animator = new Animator(this._el, path, data, sounds);\r\n\r\n        this._balloon = new Balloon(this._el);\r\n\r\n        this._setupEvents();\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {Number} x\r\n     * @param {Number} y\r\n     */\r\n    gestureAt (x, y) {\r\n        let d = this._getDirection(x, y);\r\n        let gAnim = 'Gesture' + d;\r\n        let lookAnim = 'Look' + d;\r\n\r\n        let animation = this.hasAnimation(gAnim) ? gAnim : lookAnim;\r\n        return this.play(animation);\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {Boolean=} fast\r\n     *\r\n     */\r\n    hide (fast, callback) {\r\n        this._hidden = true;\r\n        let el = this._el;\r\n        this.stop();\r\n        if (fast) {\r\n            this._el.hide();\r\n            this.stop();\r\n            this.pause();\r\n            if (callback) callback();\r\n            return;\r\n        }\r\n\r\n        return this._playInternal('Hide', function () {\r\n            el.hide();\r\n            this.pause();\r\n            if (callback) callback();\r\n        })\r\n    }\r\n\r\n\r\n    moveTo (x, y, duration) {\r\n        let dir = this._getDirection(x, y);\r\n        let anim = 'Move' + dir;\r\n        if (duration === undefined) duration = 1000;\r\n\r\n        this._addToQueue(function (complete) {\r\n            // the simple case\r\n            if (duration === 0) {\r\n                this._el.css({ top: y, left: x });\r\n                this.reposition();\r\n                complete();\r\n                return;\r\n            }\r\n\r\n            // no animations\r\n            if (!this.hasAnimation(anim)) {\r\n                this._el.animate({ top: y, left: x }, duration, complete);\r\n                return;\r\n            }\r\n\r\n            let callback = $.proxy(function (name, state) {\r\n                // when exited, complete\r\n                if (state === Animator.States.EXITED) {\r\n                    complete();\r\n                }\r\n                // if waiting,\r\n                if (state === Animator.States.WAITING) {\r\n                    this._el.animate({ top: y, left: x }, duration, $.proxy(function () {\r\n                        // after we're done with the movement, do the exit animation\r\n                        this._animator.exitAnimation();\r\n                    }, this));\r\n                }\r\n\r\n            }, this);\r\n\r\n            this._playInternal(anim, callback);\r\n        }, this);\r\n    }\r\n\r\n    _playInternal (animation, callback) {\r\n\r\n        // if we're inside an idle animation,\r\n        if (this._isIdleAnimation() && this._idleDfd && this._idleDfd.state() === 'pending') {\r\n            this._idleDfd.done($.proxy(function () {\r\n                this._playInternal(animation, callback);\r\n            }, this))\r\n        }\r\n\r\n        this._animator.showAnimation(animation, callback);\r\n    }\r\n\r\n    play (animation, timeout, cb) {\r\n        if (!this.hasAnimation(animation)) return false;\r\n\r\n        if (timeout === undefined) timeout = 5000;\r\n\r\n\r\n        this._addToQueue(function (complete) {\r\n            let completed = false;\r\n            // handle callback\r\n            let callback = function (name, state) {\r\n                if (state === Animator.States.EXITED) {\r\n                    completed = true;\r\n                    if (cb) cb();\r\n                    complete();\r\n                }\r\n            };\r\n\r\n            // if has timeout, register a timeout function\r\n            if (timeout) {\r\n                window.setTimeout($.proxy(function () {\r\n                    if (completed) return;\r\n                    // exit after timeout\r\n                    this._animator.exitAnimation();\r\n                }, this), timeout)\r\n            }\r\n\r\n            this._playInternal(animation, callback);\r\n        }, this);\r\n\r\n        return true;\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {Boolean=} fast\r\n     */\r\n    show (fast) {\r\n\r\n        this._hidden = false;\r\n        if (fast) {\r\n            this._el.show();\r\n            this.resume();\r\n            this._onQueueEmpty();\r\n            return;\r\n        }\r\n\r\n        if (this._el.css('top') === 'auto' || !this._el.css('left') === 'auto') {\r\n            let left = $(window).width() * 0.8;\r\n            let top = ($(window).height() + $(document).scrollTop()) * 0.8;\r\n            this._el.css({ top: top, left: left });\r\n        }\r\n\r\n        this.resume();\r\n        return this.play('Show');\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {String} text\r\n     */\r\n    speak (text, hold) {\r\n        this._addToQueue(function (complete) {\r\n            this._balloon.speak(complete, text, hold);\r\n        }, this);\r\n    }\r\n\r\n\r\n    /***\r\n     * Close the current balloon\r\n     */\r\n    closeBalloon () {\r\n        this._balloon.hide();\r\n    }\r\n\r\n    delay (time) {\r\n        time = time || 250;\r\n\r\n        this._addToQueue(function (complete) {\r\n            this._onQueueEmpty();\r\n            window.setTimeout(complete, time);\r\n        });\r\n    }\r\n\r\n    /***\r\n     * Skips the current animation\r\n     */\r\n    stopCurrent () {\r\n        this._animator.exitAnimation();\r\n        this._balloon.close();\r\n    }\r\n\r\n\r\n    stop () {\r\n        // clear the queue\r\n        this._queue.clear();\r\n        this._animator.exitAnimation();\r\n        this._balloon.hide();\r\n    }\r\n\r\n    /***\r\n     *\r\n     * @param {String} name\r\n     * @returns {Boolean}\r\n     */\r\n    hasAnimation (name) {\r\n        return this._animator.hasAnimation(name);\r\n    }\r\n\r\n    /***\r\n     * Gets a list of animation names\r\n     *\r\n     * @return {Array.<string>}\r\n     */\r\n    animations () {\r\n        return this._animator.animations();\r\n    }\r\n\r\n    /***\r\n     * Play a random animation\r\n     * @return {jQuery.Deferred}\r\n     */\r\n    animate () {\r\n        let animations = this.animations();\r\n        let anim = animations[Math.floor(Math.random() * animations.length)];\r\n        // skip idle animations\r\n        if (anim.indexOf('Idle') === 0) {\r\n            return this.animate();\r\n        }\r\n        return this.play(anim);\r\n    }\r\n\r\n    /**************************** Utils ************************************/\r\n\r\n    /***\r\n     *\r\n     * @param {Number} x\r\n     * @param {Number} y\r\n     * @return {String}\r\n     * @private\r\n     */\r\n    _getDirection (x, y) {\r\n        let offset = this._el.offset();\r\n        let h = this._el.height();\r\n        let w = this._el.width();\r\n\r\n        let centerX = (offset.left + w / 2);\r\n        let centerY = (offset.top + h / 2);\r\n\r\n\r\n        let a = centerY - y;\r\n        let b = centerX - x;\r\n\r\n        let r = Math.round((180 * Math.atan2(a, b)) / Math.PI);\r\n\r\n        // Left and Right are for the character, not the screen :-/\r\n        if (-45 <= r && r < 45) return 'Right';\r\n        if (45 <= r && r < 135) return 'Up';\r\n        if (135 <= r && r <= 180 || -180 <= r && r < -135) return 'Left';\r\n        if (-135 <= r && r < -45) return 'Down';\r\n\r\n        // sanity check\r\n        return 'Top';\r\n    }\r\n\r\n    /**************************** Queue and Idle handling ************************************/\r\n\r\n    /***\r\n     * Handle empty queue.\r\n     * We need to transition the animation to an idle state\r\n     * @private\r\n     */\r\n    _onQueueEmpty () {\r\n        if (this._hidden || this._isIdleAnimation()) return;\r\n        let idleAnim = this._getIdleAnimation();\r\n        this._idleDfd = $.Deferred();\r\n\r\n        this._animator.showAnimation(idleAnim, $.proxy(this._onIdleComplete, this));\r\n    }\r\n\r\n    _onIdleComplete (name, state) {\r\n        if (state === Animator.States.EXITED) {\r\n            this._idleDfd.resolve();\r\n        }\r\n    }\r\n\r\n    /***\r\n     * Is the current animation is Idle?\r\n     * @return {Boolean}\r\n     * @private\r\n     */\r\n    _isIdleAnimation () {\r\n        let c = this._animator.currentAnimationName;\r\n        return c && c.indexOf('Idle') === 0;\r\n    }\r\n\r\n\r\n    /**\r\n     * Gets a random Idle animation\r\n     * @return {String}\r\n     * @private\r\n     */\r\n    _getIdleAnimation () {\r\n        let animations = this.animations();\r\n        let r = [];\r\n        for (let i = 0; i < animations.length; i++) {\r\n            let a = animations[i];\r\n            if (a.indexOf('Idle') === 0) {\r\n                r.push(a);\r\n            }\r\n        }\r\n\r\n        // pick one\r\n        let idx = Math.floor(Math.random() * r.length);\r\n        return r[idx];\r\n    }\r\n\r\n    /**************************** Events ************************************/\r\n\r\n    _setupEvents () {\r\n        $(window).on('resize', $.proxy(this.reposition, this));\r\n\r\n        this._el.on('mousedown', $.proxy(this._onMouseDown, this));\r\n\r\n        this._el.on('dblclick', $.proxy(this._onDoubleClick, this));\r\n    }\r\n\r\n    _onDoubleClick () {\r\n        if (!this.play('ClickedOn')) {\r\n            this.animate();\r\n        }\r\n    }\r\n\r\n    reposition () {\r\n        if (!this._el.is(':visible')) return;\r\n        let o = this._el.offset();\r\n        let bH = this._el.outerHeight();\r\n        let bW = this._el.outerWidth();\r\n\r\n        let wW = $(window).width();\r\n        let wH = $(window).height();\r\n        let sT = $(window).scrollTop();\r\n        let sL = $(window).scrollLeft();\r\n\r\n        let top = o.top - sT;\r\n        let left = o.left - sL;\r\n        let m = 5;\r\n        if (top - m < 0) {\r\n            top = m;\r\n        } else if ((top + bH + m) > wH) {\r\n            top = wH - bH - m;\r\n        }\r\n\r\n        if (left - m < 0) {\r\n            left = m;\r\n        } else if (left + bW + m > wW) {\r\n            left = wW - bW - m;\r\n        }\r\n\r\n        this._el.css({ left: left, top: top });\r\n        // reposition balloon\r\n        this._balloon.reposition();\r\n    }\r\n\r\n    _onMouseDown (e) {\r\n        e.preventDefault();\r\n        this._startDrag(e);\r\n    }\r\n\r\n\r\n    /**************************** Drag ************************************/\r\n\r\n    _startDrag (e) {\r\n        // pause animations\r\n        this.pause();\r\n        this._balloon.hide(true);\r\n        this._offset = this._calculateClickOffset(e);\r\n\r\n        this._moveHandle = $.proxy(this._dragMove, this);\r\n        this._upHandle = $.proxy(this._finishDrag, this);\r\n\r\n        $(window).on('mousemove', this._moveHandle);\r\n        $(window).on('mouseup', this._upHandle);\r\n\r\n        this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\r\n    }\r\n\r\n    _calculateClickOffset (e) {\r\n        let mouseX = e.pageX;\r\n        let mouseY = e.pageY;\r\n        let o = this._el.offset();\r\n        return {\r\n            top: mouseY - o.top,\r\n            left: mouseX - o.left\r\n        }\r\n\r\n    }\r\n\r\n    _updateLocation () {\r\n        this._el.css({ top: this._targetY, left: this._targetX });\r\n        this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\r\n    }\r\n\r\n    _dragMove (e) {\r\n        e.preventDefault();\r\n        let x = e.clientX - this._offset.left;\r\n        let y = e.clientY - this._offset.top;\r\n        this._targetX = x;\r\n        this._targetY = y;\r\n    }\r\n\r\n    _finishDrag () {\r\n        window.clearTimeout(this._dragUpdateLoop);\r\n        // remove handles\r\n        $(window).off('mousemove', this._moveHandle);\r\n        $(window).off('mouseup', this._upHandle);\r\n        // resume animations\r\n        this._balloon.show();\r\n        this.reposition();\r\n        this.resume();\r\n\r\n    }\r\n\r\n    _addToQueue (func, scope) {\r\n        if (scope) func = $.proxy(func, scope);\r\n        this._queue.queue(func);\r\n    }\r\n\r\n    /**************************** Pause and Resume ************************************/\r\n\r\n    pause () {\r\n        this._animator.pause();\r\n        this._balloon.pause();\r\n\r\n    }\r\n\r\n    resume () {\r\n        this._animator.resume();\r\n        this._balloon.resume();\r\n    }\r\n\r\n}","import $ from 'jquery'\r\nimport Agent from './agent'\r\n\r\nexport class load {\r\n    constructor (name, successCb, failCb, base_path) {\r\n        //.BEGIN HACK\r\n        base_path = 'assets/agents/';\r\n        //.END HACK\r\n        base_path = base_path || window.CLIPPY_CDN || 'https://gitcdn.xyz/repo/pi0/clippyjs/master/assets/agents/';\r\n\r\n        let path = base_path + name;\r\n        let mapDfd = load._loadMap(path);\r\n        let agentDfd = load._loadAgent(name, path);\r\n        let soundsDfd = load._loadSounds(name, path);\r\n\r\n        let data;\r\n        agentDfd.done(function (d) {\r\n            data = d;\r\n        });\r\n\r\n        let sounds;\r\n\r\n        soundsDfd.done(function (d) {\r\n            sounds = d;\r\n        });\r\n\r\n        // wrapper to the success callback\r\n        let cb = function () {\r\n            let a = new Agent(path, data, sounds);\r\n            successCb(a);\r\n        };\r\n\r\n        $.when(mapDfd, agentDfd, soundsDfd).done(cb).fail(failCb);\r\n    }\r\n\r\n    static _loadMap (path) {\r\n        let dfd = load._maps[path];\r\n        if (dfd) return dfd;\r\n\r\n        // set dfd if not defined\r\n        dfd = load._maps[path] = $.Deferred();\r\n\r\n        let src = path + '/map.png';\r\n        let img = new Image();\r\n\r\n        img.onload = dfd.resolve;\r\n        img.onerror = dfd.reject;\r\n\r\n        // start loading the map;\r\n        img.setAttribute('src', src);\r\n\r\n        return dfd.promise();\r\n    }\r\n\r\n    static _loadSounds (name, path) {\r\n        let dfd = load._sounds[name];\r\n        if (dfd) return dfd;\r\n\r\n        // set dfd if not defined\r\n        dfd = load._sounds[name] = $.Deferred();\r\n\r\n        let audio = document.createElement('audio');\r\n        let canPlayMp3 = !!audio.canPlayType && \"\" !== audio.canPlayType('audio/mpeg');\r\n        let canPlayOgg = !!audio.canPlayType && \"\" !== audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\r\n\r\n        if (!canPlayMp3 && !canPlayOgg) {\r\n            dfd.resolve({});\r\n        } else {\r\n            let src = path + (canPlayMp3 ? '/sounds-mp3.js' : '/sounds-ogg.js');\r\n            // load\r\n            load._loadScript(src);\r\n        }\r\n\r\n        return dfd.promise()\r\n    }\r\n\r\n    static _loadAgent (name, path) {\r\n        let dfd = load._data[name];\r\n        if (dfd) return dfd;\r\n\r\n        dfd = load._getAgentDfd(name);\r\n\r\n        let src = path + '/agent.js';\r\n\r\n        load._loadScript(src);\r\n\r\n        return dfd.promise();\r\n    }\r\n\r\n    static _loadScript (src) {\r\n        let script = document.createElement('script');\r\n        script.setAttribute('src', src);\r\n        script.setAttribute('async', 'async');\r\n        script.setAttribute('type', 'text/javascript');\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n\r\n    static _getAgentDfd (name) {\r\n        let dfd = load._data[name];\r\n        if (!dfd) {\r\n            dfd = load._data[name] = $.Deferred();\r\n        }\r\n        return dfd;\r\n    }\r\n}\r\n\r\nload._maps = {};\r\nload._sounds = {};\r\nload._data = {};\r\n\r\nexport function ready (name, data) {\r\n    let dfd = load._getAgentDfd(name);\r\n    dfd.resolve(data);\r\n}\r\n\r\nexport function soundsReady (name, data) {\r\n    let dfd = load._sounds[name];\r\n    if (!dfd) {\r\n        dfd = load._sounds[name] = $.Deferred();\r\n    }\r\n\r\n    dfd.resolve(data);\r\n}\r\n","import Agent from './agent'\r\nimport Animator from './animator'\r\nimport Queue from './queue'\r\nimport Balloon from './balloon'\r\nimport { load, ready, soundsReady } from './load'\r\n\r\nconst clippy = {\r\n    Agent,\r\n    Animator,\r\n    Queue,\r\n    Balloon,\r\n    load,\r\n    ready,\r\n    soundsReady\r\n}\r\n\r\nexport default clippy\r\n\r\nif (typeof window !== 'undefined') {\r\n    window.clippy = clippy\r\n}\r\n\r\n\r\n"],"names":["let","this","const"],"mappings":"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"}